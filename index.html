<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Indicator</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
    integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog=="
    crossorigin="anonymous" />

</head>

<body>
  <header>

    <h2>2F</h2>
    <div class="openbtn"><span></span><span></span><span></span></div>
    <nav id="g-nav">
        <ul>
          <li><a href="index.html">2F</a></li>
          <li><a href="index2.html">3F</a></li>
          <li><a href="index3.html">4F</a></li>
          <li><a href="index4.html">5F</a></li>
        </ul>
    </nav>
    <nav class="gnav">
      <div class="btn-box">
        <a href="#" id="201" class="btn_02">201</a>
        <a href="#" id="202" class="btn_02">202</a>
        <a href="#" id="203" class="btn_02">203</a>
        <a href="#" id="204" class="btn_02">204</a>
        <a href="#" id="205" class="btn_02">205</a>
      </div>
    </nav>
  </header>

  <main>

    <div class="floorBox">
      <img id="floorMap" src="img/BH_WEBy_2.svg" alt="">
 

      <div id="section201"><img class="hideMapA" src="img/a1.png" alt="">
      </div>
      <div id="section202"><img class="hideMapB" src="img/a2.png" alt="">
      </div>
      <div id="section203"><img class="hideMapC" src="img/a3.png" alt="">
      </div>
      <div id="section204"><img class="hideMapD" src="img/a4.png" alt="">
      </div>
      <div id="section205"><img class="hideMapE" src="img/a5.png" alt="">

      </div>
    </div>

    <div id="button">
      <a id="save" href="#" class="btn_02">SAVE</a>
      <a id="clear" href="#" class="btn_02">CLEAR</a>
      <a id="reload" href="#" class="btn_02">RELOAD</a>

    </div>

    

  </main>
<footer>
  <button class="add" id="add">
    <i class="fas fa-plus"></i> Add
  </button>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/1.2.2/marked.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
// 部屋情報を受け取る
    var room = [];

    // Humberger
    $(function () {
        $('.nav_toggle').on('click', function () {
          $('.nav_toggle, .nav').toggleClass('show');
        });
      });

      // Humberger
      $(".openbtn").click(function () {//ボタンがクリックされたら
          $(this).toggleClass('active');//ボタン自身に activeクラスを付与し
          $("#g-nav").toggleClass('panelactive');//ナビゲーションにpanelactiveクラスを付与
        });

        $("#g-nav a").click(function () {//ナビゲーションのリンクがクリックされたら
          $(".openbtn").removeClass('active');//ボタンの activeクラスを除去し
          $("#g-nav").removeClass('panelactive');//ナビゲーションのpanelactiveクラスも除去
        });

        
 // クリックで画像を表示し配列roomへpush
    $('#section201').toggle();
    $(function () {
      $("#201").click(function () {
        $("#section201").toggle();
        room.push('201');
        console.log(room);
      });
    });

    $("#section202").toggle();
    $(function () {
      $("#202").click(function () {
        $("#section202").toggle();
        room.push('202');
        console.log(room);
      });
    });

    $("#section203").toggle();
    $(function () {
      $("#203").click(function () {
        $("#section203").toggle();
        room.push('203');
        console.log(room);
      });
    });

    $("#section204").toggle();
    $(function () {
      $("#204").click(function () {
        $("#section204").toggle();
        room.push('204');
        console.log(room);
      });
    });


    $("#section205").toggle();
    $(function () {
      $("#205").click(function () {
        $("#section205").toggle();
        room.push('205');
        console.log(room);
      });
    });

    //1.Save クリックイベント
    $('#save').on('click', function () {
      localStorage.setItem('room', room);
    });


    //2.clear クリックイベント

    $('#clear').on('click', function () {
      $('.hideMapA').hide();
      $('.hideMapB').hide();
      $('.hideMapC').hide();
      $('.hideMapD').hide();
      $('.hideMapE').hide();
      localStorage.removeItem('room');
    });

   
    // Point: 「.val()」は()に何か入れると入れた値で上書きする!
    // 空の文字列で上書き
    //3.ページ読み込み：保存データ取得表示
    if (localStorage.getItem('room')) { // 値が保存されていれば 
      const text = localStorage.getItem('room'); // データを取得
      var result1 = text.includes('201');
      if (result1 == true) {
        console.log(result1)
        $("#section201").show();
      };
      var result2 = text.includes('202');
      if (result2 == true) {
        console.log(result2)
        $("#section202").show();
      };
      var result3 = text.includes('203');
      if (result3 == true) {
        console.log(result3)
        $("#section203").show();
      };
      var result4 = text.includes('204');
      if (result4 == true) {
        console.log(result4)
        $("#section204").show();
      };
      var result5 = text.includes('205');
      if (result5 == true) {
        console.log(result5)
        $("#section205").show();
      };
    };
// リロード
  $('#reload').click(function () {
    location.reload();
  });

  // memo
  // 要素を取得する
    const addBtn = document.getElementById('add')

    // ローカルストレージからデータを取得する
    const notes = JSON.parse(localStorage.getItem('notes'))

    // メモ帳追加処理を実行
    if (notes) {
      notes.forEach(note => addNewNote(note))
    }

    // 作成ボタンのクリックイベントの登録
    addBtn.addEventListener('click', () => addNewNote())

    function addNewNote(text = '') {
      // div要素を作成
      const note = document.createElement('div')
      // noteクラスを追加
      note.classList.add('note')

      // メモ帳を追加
      note.innerHTML = `
    <div class="tools">
        <button class="edit"><i class="fas fa-edit"></i></button>
        <button class="delete"><i class="fas fa-trash-alt"></i></button>
    </div>
    <div class="main ${text ? "" : "hidden"}"></div>
    <textarea class="${text ? "hidden" : ""}"></textarea>
    `

      // 操作に必要な要素を取得
      const editBtn = note.querySelector('.edit')
      const deleteBtn = note.querySelector('.delete')
      const main = note.querySelector('.main')
      const textArea = note.querySelector('textarea')

      // テキストエリアに引数で渡したテキストを代入
      // 新規/編集があるのでこうしている
      textArea.value = text
      // markedは、HTMLに追加したプラグイン
      main.innerHTML = marked(text)

      // 削除のクリックイベントの登録
      deleteBtn.addEventListener('click', () => {
        deleteNote(note)
      })

      // 編集ボタンのクリックイベント
      editBtn.addEventListener('click', () => {
        editNote(main, textArea)
      })

      // テキストエリアのイベント
      textArea.addEventListener('input', (e) => {
        const { value } = e.target

        main.innerHTML = marked(value)

        // ローカルストレージの更新
        updateLS()
      })

      // bodyの子要素として追加
      document.body.appendChild(note)
    }

    // ローカルストレージにメモ帳を保存
    function updateLS() {
      // 要素を取得
      const notesText = document.querySelectorAll('textarea')

      const notes = []

      // 要素を格納
      notesText.forEach(note => notes.push(note.value))

      // notesという名前でローカルストレージを保存
      localStorage.setItem('notes', JSON.stringify(notes))
    }

    // メモ帳削除
    function deleteNote(note) {
      // ノートを削除
      note.remove()

      // ローカルストレージの更新
      updateLS()
    }

    // メモ帳編集
    function editNote(main, textArea) {
      // hiddenがついているものは消し、ついてないものは付与する
      main.classList.toggle('hidden')
      textArea.classList.toggle('hidden')
    }

  </script>

</body>

</html>