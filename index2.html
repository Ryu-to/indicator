<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Indicator</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog=="
  crossorigin="anonymous" />

</head>

<body>
  <header>
    <h2>3F</h2>
    <div class="openbtn"><span></span><span></span><span></span></div>
    <nav id="g-nav">
    
        <ul>
          <li><a href="index.html">2F</a></li>
          <li><a href="index2.html">3F</a></li>
          <li><a href="index3.html">4F</a></li>
          <li><a href="index4.html">5F</a></li>
        </ul>
    </nav>
    <nav class="gnav">
      <div class="btn-box">
        <a href="#" id="301" class="btn_02">301</a>
        <a href="#" id="302" class="btn_02">302</a>
        <a href="#" id="303" class="btn_02">303</a>
        <a href="#" id="304" class="btn_02">304</a>
        <a href="#" id="305" class="btn_02">305</a>
      </div>
    </nav>
  </header>

  <main>

    <div class="floorBox">
      <img id="floorMap" src="img/BH_WEBy_2.svg" alt="">

      <div id="section301"><img class="hideMapA" src="img/a1.png" alt="">
      </div>
      <div id="section302"><img class="hideMapB" src="img/a2.png" alt="">
      </div>
      <div id="section303"><img class="hideMapC" src="img/a3.png" alt="">
      </div>
      <div id="section304"><img class="hideMapD" src="img/a4.png" alt="">
      </div>
      <div id="section305"><img class="hideMapE" src="img/a5.png" alt="">

      </div>
    </div>

    <div id="button">
      <a id="save" href="#" class="btn_02">SAVE</a>
      <a id="clear" href="#" class="btn_02">CLEAR</a>
      <a id="reload" href="#" class="btn_02">RELOAD</a>

    </div>

  </main>
<footer>
  <button class="add" id="add">
    <i class="fas fa-plus"></i> Add
  </button>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/1.2.2/marked.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
  // 部屋情報を受け取る
    var roomThree = [];

  // Humberger
  $(".openbtn").click(function () {//ボタンがクリックされたら
    $(this).toggleClass('active');//ボタン自身に activeクラスを付与し
    $("#g-nav").toggleClass('panelactive');//ナビゲーションにpanelactiveクラスを付与
  });

  $("#g-nav a").click(function () {//ナビゲーションのリンクがクリックされたら
    $(".openbtn").removeClass('active');//ボタンの activeクラスを除去し
    $("#g-nav").removeClass('panelactive');//ナビゲーションのpanelactiveクラスも除去
  });

  // ページ遷移
  $('#up').click(function () {
    location.href = 'index3.html';
  })

  $('#down').click(function () {
      location.href = 'index.html';
    })

 // クリックで画像を表示し配列roomThreeThreeへpush

    $('#section301').toggle();
    $(function () {
      // $("#section201").css("display", "none");
      $("#301").click(function () {
        $("#section301").toggle();
        roomThree.push('301');
        console.log(roomThree);
      });
    });

    $("#section302").toggle();
    $(function () {
      $("#302").click(function () {
        $("#section302").toggle();
        roomThree.push('302');
        console.log(roomThree);
      });
    });

    $("#section303").toggle();
    $(function () {
      $("#303").click(function () {
        $("#section303").toggle();
        roomThree.push('303');
        console.log(roomThree);
      });
    });

    $("#section304").toggle();
    $(function () {
      $("#304").click(function () {
        $("#section304").toggle();
        roomThree.push('304');
        console.log(roomThree);
      });
    });


    $("#section305").toggle();
    $(function () {
      $("#305").click(function () {
        $("#section305").toggle();
        roomThree.push('305');
        console.log(roomThree);
      });
    });

    //1.Save クリックイベント
    $('#save').on('click', function () {
      localStorage.setItem('roomThree', roomThree);
    });


    //2.clear クリックイベント

    $('#clear').on('click', function () {
      $('.hideMapA').hide();
      $('.hideMapB').hide();
      $('.hideMapC').hide();
      $('.hideMapD').hide();
      $('.hideMapE').hide();
      localStorage.removeItem('roomThree');
    });

    $('#reload').click(function () {
      location.reload();
    });
    // Point: 「.val()」は()に何か入れると入れた値で上書きする!
    // 空の文字列で上書き
    //3.ページ読み込み：保存データ取得表示
    if (localStorage.getItem('roomThree')) { // 値が保存されていれば 
      const text = localStorage.getItem('roomThree'); // データを取得
      var result6 = text.includes('301');
      if (result6 == true) {
        console.log(result6)
        $("#section301").show();
      };
      var result7 = text.includes('302');
      if (result7 == true) {
        console.log(result7)
        $("#section302").show();
      };
      var result8 = text.includes('303');
      if (result8 == true) {
        console.log(result8)
        $("#section303").show();
      };
      var result9 = text.includes('304');
      if (result9 == true) {
        console.log(result9)
        $("#section304").show();
      };
      var result10 = text.includes('305');
      if (result10 == true) {
        console.log(result10)
        $("#section305").show();
      };
    };
  // memo
  // 要素を取得する
  const addBtn = document.getElementById('add')

  // ローカルストレージからデータを取得する
  const notes = JSON.parse(localStorage.getItem('notes'))

  // メモ帳追加処理を実行
  if (notes) {
    notes.forEach(note => addNewNote(note))
  }

  // 作成ボタンのクリックイベントの登録
  addBtn.addEventListener('click', () => addNewNote())

  function addNewNote(text = '') {
    // div要素を作成
    const note = document.createElement('div')
    // noteクラスを追加
    note.classList.add('note')

    // メモ帳を追加
    note.innerHTML = `
    <div class="tools">
        <button class="edit"><i class="fas fa-edit"></i></button>
        <button class="delete"><i class="fas fa-trash-alt"></i></button>
    </div>
    <div class="main ${text ? "" : "hidden"}"></div>
    <textarea class="${text ? "hidden" : ""}"></textarea>
    `

    // 操作に必要な要素を取得
    const editBtn = note.querySelector('.edit')
    const deleteBtn = note.querySelector('.delete')
    const main = note.querySelector('.main')
    const textArea = note.querySelector('textarea')

    // テキストエリアに引数で渡したテキストを代入
    // 新規/編集があるのでこうしている
    textArea.value = text
    // markedは、HTMLに追加したプラグイン
    main.innerHTML = marked(text)

    // 削除のクリックイベントの登録
    deleteBtn.addEventListener('click', () => {
      deleteNote(note)
    })

    // 編集ボタンのクリックイベント
    editBtn.addEventListener('click', () => {
      editNote(main, textArea)
    })

    // テキストエリアのイベント
    textArea.addEventListener('input', (e) => {
      const { value } = e.target

      main.innerHTML = marked(value)

      // ローカルストレージの更新
      updateLS()
    })

    // bodyの子要素として追加
    document.body.appendChild(note)
  }

  // ローカルストレージにメモ帳を保存
  function updateLS() {
    // 要素を取得
    const notesText = document.querySelectorAll('textarea')

    const notes = []

    // 要素を格納
    notesText.forEach(note => notes.push(note.value))

    // notesという名前でローカルストレージを保存
    localStorage.setItem('notes', JSON.stringify(notes))
  }

  // メモ帳削除
  function deleteNote(note) {
    // ノートを削除
    note.remove()

    // ローカルストレージの更新
    updateLS()
  }

  // メモ帳編集
  function editNote(main, textArea) {
    // hiddenがついているものは消し、ついてないものは付与する
    main.classList.toggle('hidden')
    textArea.classList.toggle('hidden')
  }
  </script>

</body>

</html>